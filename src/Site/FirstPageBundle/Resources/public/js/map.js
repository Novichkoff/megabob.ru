ymaps.ready(init);function init(){var myMap;$('.advs_on_map_c').bind({click:function(){if(!myMap){if($('#current_town').text()){if($('#current_area').text()){var city=$('#current_area').text()+', '+$('#current_town').text();}else{var city=$('#current_town').text();}
var zoom=10;}else if($('#current_area').text()){var city=$('#current_area').text();var zoom=7;}else if($('#area').val()){if($('#region').val()){var city=$('#area option:selected').text()+', '+$('#region option:selected').text();var zoom=10;}else{var city=$('#area option:selected').text();var zoom=7;}}else{var city='Россия';var zoom=4;}
if(city=='Все регионы, Все города'){var city='Россия';var zoom=4;}
console.log(city);cid=$(this).data('category');ymaps.geocode(city,{results:1}).then(function(res){ymaps.modules.require(['PieChartClustererLayout'],function(PieChartClustererLayout){var firstGeoObject=res.geoObjects.get(0);myMap=new ymaps.Map('aamap',{center:firstGeoObject.geometry.getCoordinates(),zoom:zoom,type:'yandex#map',behaviors:['default'],controls:['zoomControl','fullscreenControl']},{suppressMapOpenBlock:true}),ButtonLayout=ymaps.templateLayoutFactory.createClass("<button class='btn btn-default btn-xs'>"+"{{data.content}}"+"</button>"),objectManager=new ymaps.ObjectManager({clusterize:true,clusterIconLayout:PieChartClustererLayout,gridSize:32,geoObjectOpenBalloonOnClick:true,clusterOpenBalloonOnClick:true});myMap.geoObjects.add(objectManager);$.ajax({url:"/all_advs_on_map",data:$("#search_form").serialize()}).done(function(data){objectManager.add(data);button=new ymaps.control.Button({data:{content:"Объектов: "+data.features.length},options:{layout:ButtonLayout}})
myMap.controls.add(button,{float:'left'});});});});$("#aamap").show();$("#c_title").hide();}else{myMap.destroy();myMap=null;$("#aamap").hide();}}});}