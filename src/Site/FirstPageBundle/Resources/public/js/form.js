$(document).on("change","#advs_dogovor",function(){$("#advs_price").val(0);$("#advs_price").prop("readonly",$("#advs_dogovor").prop("checked"));});$(document).on("changed.bs.select","select.changeable",function(e){e.preventDefault();e.stopPropagation();$(".loading").show();if($(this).val()){$(this).closest(".form-group").removeClass("has-error");}
var update_url=$(this).closest("form").data("update");$.ajax({url:update_url,type:"POST",data:$("#add_adv_form").serialize(),success:function(data){name_adv=$("#name_adv",data);$("#name_adv").html(name_adv);desc_adv=$("#desc_adv",data);$("#desc_adv").html(desc_adv);price_div=$("#price_div",data);$("#price_div").html(price_div);town=$("#town",data);$("#town").html(town.children());params=$("#params",data);$("#params").html(params.children());captcha_field=$("#captcha_field",data);$("#captcha_field").html(captcha_field.children());$('[data-toggle="tooltip"]').tooltip();$(":input").inputmask();$(".selectpicker").selectpicker().hide();$(document).ready(function(){$("#advs_name").bind("textchange",function(){$(this.parentElement).attr("id","name_parent");var text=$("#advs_name").val();if(text===text.toUpperCase()&&text.length>1){$(this.parentElement).addClass("has-error");if(!document.getElementById("helpBlock")){$(this.parentElement).append('<span id="helpBlock" class="help-block red">Не используйте только заглавные буквы!</span>');}}else{$(this.parentElement).removeClass("has-error");$("#helpBlock").remove();}
var town=$("#advs_region_id option:selected").text();var text_array=text.split(" ");text_array.forEach(function(word){var procent=similar_text(word.toLowerCase(),town.toLowerCase(),true);if(procent>70){$("#name_parent").addClass("has-error");if(!document.getElementById("helpTownBlock")){$("#name_parent").append('<span id="helpTownBlock" class="help-block red">Не добавляйте название города! Мы добавляем его автоматически.</span>');}}else{$("#name_parent").removeClass("has-error");$("#helpTownBlock").remove();}});text=capitaliseFirstLetter(text);$("#advs_name").val(text);return true;});});$(".loading").hide();}});});$(document).on("changed.bs.select","select.changeable_s",function(e){e.preventDefault();e.stopPropagation();$(".loading").show();if($('#shops_region_id').length){$('#shops_region_id').val(0);}
$.ajax({type:"POST",data:$("#add_shop_form").serialize(),success:function(data){form=$("#add_shop_form",data);$("#add_shop_form").html(form.children());$(".selectpicker").selectpicker().hide();$(".loading").hide();}});});$(document).on("mouseover",".use_help",function(e){var id=$(this).data("id");$("#help-"+id).show();});$(document).on("mouseout",".use_help",function(e){var id=$(this).data("id");$("#help-"+id).hide();});function similar_text(first,second,percent){if(first===null||second===null||typeof first==="undefined"||typeof second==="undefined"){return 0;}
first+="";second+="";var pos1=0,pos2=0,max=0,firstLength=first.length,secondLength=second.length,p,q,l,sum;max=0;for(p=0;p<firstLength;p++){for(q=0;q<secondLength;q++){for(l=0;(p+l<firstLength)&&(q+l<secondLength)&&(first.charAt(p+l)===second.charAt(q+l));l++){}
if(l>max){max=l;pos1=p;pos2=q;}}}
sum=max;if(sum){if(pos1&&pos2){sum+=this.similar_text(first.substr(0,pos1),second.substr(0,pos2));}
if((pos1+max<firstLength)&&(pos2+max<secondLength)){sum+=this.similar_text(first.substr(pos1+max,firstLength-pos1-max),second.substr(pos2+max,secondLength-pos2-max));}}
if(!percent){return sum;}else{return(sum*200)/(firstLength+secondLength);}}
$(document).on("change",".search_changeable",function(){$(".loading").show();$.ajax({url:"/search_form_update",type:"POST",data:$("#search_form").serialize(),success:function(data){$("#search_form_div").html(data);$(".selectpicker").selectpicker().hide();$(".loading").hide();}});});$(document).on("click","#advs_user_type_0",function(){$("#company").html("");});$(document).on("click","#jobs_user_type_0",function(){$("#company").html("");});$(document).on("change","#advs_email",function(){$(".loading").show();var update_url=$(this).closest("form").data("update");$.ajax({url:update_url,type:"POST",data:$("#add_adv_form").serialize(),success:function(data){company=$("#user_pass",data);$("#user_pass").html(company);captcha_field=$("#captcha_field",data);$("#captcha_field").html(captcha_field);$('[data-toggle="tooltip"]').tooltip();$(":input").inputmask();$(".selectpicker").selectpicker().hide();$(".loading").hide();}});});$(document).on("change","#advs_user_type_1",function(){$(".loading").show();var update_url=$(this).closest("form").data("update");$.ajax({url:update_url,type:"POST",data:$("#add_adv_form").serialize(),success:function(data){company=$("#company",data);$("#company").html(company);captcha_field=$("#captcha_field",data);$("#captcha_field").html(captcha_field);$('[data-toggle="tooltip"]').tooltip();$(":input").inputmask();$(".selectpicker").selectpicker().hide();$(".loading").hide();}});});$(document).on("change",".filter_changeable",function(){$(".loading").show();$.ajax({url:"/filter_update",type:"POST",data:$("#filter_form").serialize(),success:function(data){$(".advs_filter").html(data);$(".selectpicker").selectpicker().hide();$(".loading").hide();}});});function imgUpload(){if(window.FormData===undefined){submitForm();}else{var fd=new FormData(document.getElementById("add_adv_form"));$.ajax({type:"POST",data:fd,processData:false,contentType:false,beforeSend:function(){$(".upload_image_animation").show();},success:function(data){$(".upload_image_animation").hide();form=$("#add_adv_form",data);$("#add_adv").html(form);$('[data-toggle="tooltip"]').tooltip();$(".selectpicker").selectpicker().hide();}});}}
function imgDelete(id){$(".loading").show();$("#advs_imagedelete").val(id);$.ajax({type:"POST",data:$("#add_adv_form").serialize(),success:function(data){form=$("#add_adv_form",data);$("#add_adv").html(form);$('[data-toggle="tooltip"]').tooltip();$(".selectpicker").selectpicker().hide();$(".loading").hide();}});}
function imgRotate(id){$(".loading").show();$("#advs_imagerotate").val(id);$.ajax({type:"POST",data:$("#add_adv_form").serialize(),success:function(data){form=$("#add_adv_form",data);$("#add_adv").html(form);$("#img_"+id).attr("src",$("#img_"+id).attr("src")+"?timestamp="+new Date().getTime());$("#advs_imagerotate").val(0);$('[data-toggle="tooltip"]').tooltip();$(".selectpicker").selectpicker().hide();$(".loading").hide();}});}
$(document).on("change","#area_select",function(){$(".loading").show();$.ajax({url:"/region_update",type:"POST",data:{id:$("#area_select").val()},success:function(data){$("#region_select").html(data);$(".selectpicker").selectpicker('refresh').hide();$(".loading").hide();}});});$(document).on("change","#region_select",function(){$(".loading").show();$(location).attr("href","/"+$("#region_select").val());});function set_param(param,value){$(".loading").show();var params={};params[param]=value;$.get("/get_params",params).done(function(){location.reload();});}
function set_params(vparams){$(".loading").show();dparams=vparams.split("&");var params={};for(var i=0;i<dparams.length;i++){fparam=dparams[i].split("=");params[fparam[0]]=fparam[1];}
$.get("/get_params",params).done(function(){location.reload();});}
function set_search_param(id,key){$("#sp_"+id).val(key);$("#map_open").val(1);$("#search_form").submit();}
function listing(){$(".listing").removeClass("mini");$(".show_all").remove();}
function show_filter(){$(".filter_on").hide();$(".filter_off").show();$("#search_filter_params").toggle();$.get("",{filt:"show"});}
function hide_filter(){$(".filter_off").hide();$("#search_filter_params").toggle();$(".filter_on").show();$.get("",{filt:"hide"});}
function get_phone(id){$(".loading").show();$.ajax({type:"POST",url:"/get_phone",data:{id:id},success:function(data){$("#phone").html('<a href="tel:'+data+'">'+data+"</a>");$(".on_claso").removeClass("hide");$(".loading").hide();}});}
function get_skype(id){$(".loading").show();$.ajax({type:"POST",url:"/get_skype",data:{id:id},success:function(data){$("#skype").html('<a href="skype:'+data+'">'+data+"</a>");$(".on_claso").removeClass("hide");$(".loading").hide();}});}
function set_click(id){$.ajax({type:"POST",url:"/set_click",data:{id:id}});}
function fill_form(){$("#fos_user_registration_form_username").val($("#fos_user_registration_form_email").val());}
function get_page(url){$(location).attr("href",url);}
function get_site(url){window.open(url,"_blank");}
function get_site_adv(id){$(".loading").show();$.ajax({type:"POST",url:"/get_site_adv",data:{id:id},success:function(data){$("#site").html('<a href="'+data+'" target="_blank">'+data+"</a>");$(".loading").hide();}});}
$(document).on("change","#packet_select",function(){$(".packets .show").removeClass("show");$(".packet_info").hide();var packet=$("#packet_select").val();$("#packet_info_"+packet).show();});function show_params(){$(".params_hide").removeClass("params_hide");$(".show-params").hide();}
$(document).on("click","#advs_save",function(e){$(".loading").show();e.preventDefault();$("#advs_imagerotate").val(0);$("#advs_enabled").val(1);$("#advs_enabledd").val(1);var form=$("#add_adv_form");$("input,textarea",form).filter("[required]:visible").filter(function(){return this.value;}).closest(".form-group").removeClass("has-error");$("select",form).filter("[required]").filter(function(){return this.value;}).closest(".form-group").removeClass("has-error");$("input,textarea",form).filter("[required]:visible").filter(function(){return!this.value;}).closest(".form-group").addClass("has-error");$("select",form).filter("[required]").filter(function(){return!this.value;}).closest(".form-group").addClass("has-error");$("input[type=checkbox]",form).filter("[required]:visible").filter(function(){return this.checked;}).closest(".form-group").removeClass("has-error");$("input[type=checkbox]",form).filter("[required]:visible").filter(function(){return!this.checked;}).closest(".form-group").addClass("has-error");if(!$(form).find(".has-error").length){if(!$("#advs_name").val()){$("#advs_name").val("generator");}
$(form).submit();}else{var elem=$(form).find(".has-error")[0];location.href="#"+$(elem).attr("id");}
$(".loading").hide();});$(document).on("click","#shop_save",function(e){$(".loading").show();e.preventDefault();$("#shops_enabledd").val(1);var form=$("#add_shop_form");$("input,textarea",form).filter("[required]:visible").filter(function(){return this.value;}).closest(".form-group").removeClass("has-error");$("select",form).filter("[required]").filter(function(){return this.value;}).closest(".form-group").removeClass("has-error");$("input,textarea",form).filter("[required]:visible").filter(function(){return!this.value;}).closest(".form-group").addClass("has-error");$("select",form).filter("[required]").filter(function(){return!this.value;}).closest(".form-group").addClass("has-error");$("input[type=checkbox]",form).filter("[required]:visible").filter(function(){return this.checked;}).closest(".form-group").removeClass("has-error");$("input[type=checkbox]",form).filter("[required]:visible").filter(function(){return!this.checked;}).closest(".form-group").addClass("has-error");if(!$(form).find(".has-error").length){$(form).submit();}
$(".loading").hide();});$("#postModal").on("show.bs.modal",function(event){var button=$(event.relatedTarget);var recipient=button.data("recipient");var adv=button.data("adv");var modal=$(this);modal.find(".recipient_id").val(recipient);modal.find(".adv_id").val(adv);});$("#postAdminModal").on("show.bs.modal",function(event){var button=$(event.relatedTarget);var recipient=button.data("recipient");var adv=button.data("adv");var modal=$(this);modal.find(".recipient_id").val(recipient);modal.find(".adv_id").val(adv);});$("#townModal").on("show.bs.modal",function(event){$("#ttown").popover("hide");});function fill_alias(){var value=$("input[id*='shops_name']").val();$("input[id*='alias']").val(translit(value));}
function translit(value){var rusChars=new Array("а","б","в","г","д","е","ё","ж","з","и","й","к","л","м","н","о","п","р","с","т","у","ф","х","ч","ц","ш","щ","э","ю","я","ы","ъ","ь"," ","'",'"',"#","$","%","&","*",",",":",";","<",">","?","[","]","^","{","}","|","!","@","(",")","-","=","+","/","\\");var transChars=new Array("a","b","v","g","d","e","jo","zh","z","i","j","k","l","m","n","o","p","r","s","t","u","f","h","ch","c","sh","csh","e","ju","ja","y","","","-","","","","","","","","","","","","","","","","","","","","","","","","","","","","");var from=value;from=from.toLowerCase();var to="";var len=from.length;var character,isRus;for(var i=0;i<len;i++){character=from.charAt(i,1);isRus=false;for(var j=0;j<rusChars.length;j++){if(character==rusChars[j]){isRus=true;break;}}
to+=(isRus)?transChars[j]:character;}
return to;}
function isiPhone(){return((navigator.platform.indexOf("iPhone")!=-1)||(navigator.platform.indexOf("iPod")!=-1));}
$(document).ready(function(){$(".to_top").hide();$(".advs_on_map_c").removeClass("hide");$('#page_loading').hide();$(window).scroll(function(){if($(this).scrollTop()>45){$(".to_top").fadeIn();}else{if($(this).scrollTop()<=45){$(".to_top").fadeOut();}}});$(".to_top a").click(function(){$("body,html").animate({scrollTop:0},800);return false;});if($("#subscribe_form")&&!$("#subscribe_form").hasClass("no-show")){var timerMulti;}
if(isiPhone()){setTimeout(function(){$(".periodical-popup").show().css('opacity',1);},15000);}});$(document).on("click",".homescreen_close, .periodical-popup",function(e){$(".periodical-popup").css('opacity',0).hide();});function close_subscribe(){$("#subscribe_form").removeClass("show_subscribe_form");$("#subscribe .close").hide();$("#subscribe .no_t").hide();}
function close_subscribe_all(){$.post("/set/session",{subscribe_form:"close"});$("#subscribe_form").removeClass("show_subscribe_form");$("#subscribe .close").hide();$("#subscribe .no_t").hide();}
$(window).load(function(){$("aside .adv_right").css("width",$("aside").parent("div").width()+"px");if($("aside").offset()){var ad_top=$("aside").offset().top;}else{var ad_top=0;}
var page_height=$("#main").height();$(window).scroll(function(){if($(this).width()>992&&page_height>1000){if($(this).scrollTop()>=ad_top){$("aside").addClass("fixed_rdv");}else{$("aside").removeClass("fixed_rdv");}
if(($(this).scrollTop()+$("aside").height())>page_height){$("aside").css('top',(page_height-($(this).scrollTop()+$("aside").height()))+'px');}else{$("aside").css('top',0);}}});});$(".nav .dropdown-menu li").on({mouseenter:function(){$(this).addClass("active");$(this).children(".dropdown-menu").show();},mouseleave:function(){$(this).removeClass("active");$(this).children(".dropdown-menu").hide();}});function add_to_favorite(id){$.ajax({url:"/add_to_favorite/"+id,success:function(){$(".fav_"+id).attr("onClick","delete_from_favorite("+id+")");$(".fav_"+id).attr("title","Удалить из избранного");$("#fav_"+id).attr("onClick","delete_from_favorite("+id+")");$("#fav_"+id).attr("title","Удалить из избранного");if($("#fav_count").length){$("#fav_count").text(parseInt($("#fav_count").text())+1);}else{$("#fav_advs").append('<span class="pull-right label label-default" id="fav_count">1</span>');}
if($("#fav_count_m").length){$("#fav_count_m").text(parseInt($("#fav_count_m").text())+1);}else{$("#fav_advs_head").append(' <span class="label label-default" id="fav_count_m">1</span>');}
$(".fav_"+id).html('<i class="fa fa-fw fa-bookmark favorite"></i>удалить');$("#fav_"+id).html('<i class="fa fa-fw fa-bookmark favorite"></i>');}});}
function delete_from_favorite(id){$.ajax({url:"/del_favorite/"+id,success:function(){if($(".fav_"+id).length||$("#fav_"+id).length){$(".fav_"+id).attr("onClick","add_to_favorite("+id+")");$(".fav_"+id).attr("title","Добавить в избранное");$("#fav_"+id).attr("onClick","add_to_favorite("+id+")");$("#fav_"+id).attr("title","Добавить в избранное");if(parseInt($("#fav_count").text())>0){$("#fav_count").text(parseInt($("#fav_count").text())-1);if(parseInt($("#fav_count").text())==0){$("#fav_count").remove();}}
if(parseInt($("#fav_count_m").text())>0){$("#fav_count_m").text(parseInt($("#fav_count_m").text())-1);if(parseInt($("#fav_count_m").text())==0){$("#fav_count_m").remove();}}
$(".fav_"+id).html('<i class="fa fa-fw fa-bookmark-o favorite"></i>в избранное');$("#fav_"+id).html('<i class="fa fa-fw fa-bookmark-o favorite"></i>');}else{location.reload();}}});}
function add_to_favorite_n(id){$.ajax({url:"/add_to_favorite_n/"+id,success:function(){$(".fav").attr("onClick","delete_from_favorite_n("+id+")");$(".fav").attr("title","Удалить из избранного");$("#fav_"+id).attr("onClick","delete_from_favorite_n("+id+")");$("#fav_"+id).attr("title","Удалить из избранного");if($("#fav_count_m").length){$("#fav_count_m").text(parseInt($("#fav_count_m").text())+1);}else{$("#fav_advs_head").append(' <span class="label label-default" id="fav_count_m">1</span>');}
$(".fav").html('<i class="fa fa-fw fa-bookmark favorite"></i> Удалить из Избранного');$("#fav_"+id).html('<i class="fa fa-fw fa-bookmark favorite"></i>');}});}
function delete_from_favorite_n(id){$.ajax({url:"/del_favorite_n/"+id,success:function(){if($(".fav").length||$("#fav_"+id).length){$(".fav").attr("onClick","add_to_favorite_n("+id+")");$(".fav").attr("title","Добавить в избранное");$("#fav_"+id).attr("onClick","add_to_favorite_n("+id+")");$("#fav_"+id).attr("title","Добавить в избранное");if(parseInt($("#fav_count").text())>0){$("#fav_count").text(parseInt($("#fav_count").text())-1);if(parseInt($("#fav_count").text())==0){$("#fav_count").remove();}}
if(parseInt($("#fav_count_m").text())>0){$("#fav_count_m").text(parseInt($("#fav_count_m").text())-1);if(parseInt($("#fav_count_m").text())==0){$("#fav_count_m").remove();}}
$(".fav").html('<i class="fa fa-fw fa-bookmark-o favorite"></i> Добавить в Избранное');$("#fav_"+id).html('<i class="fa fa-fw fa-bookmark-o favorite"></i>');}else{location.reload();}}});}
function full_message(id){$(".loading").show();$.ajax({type:"POST",url:"/full_message",data:{id:id},success:function(data){$("#message_"+id).html(data);$("#message_"+id).closest("tr").removeClass("danger");$(".loading").hide();}});}
$(".confirm-delete").on("click",function(e){e.preventDefault();var id=$(this).data("id");$("#deleteModal").data("id",id);});$("#btnDeleteAdvForever").click(function(){var id=$("#deleteModal").data("id");location.href="./delete_forever_adv/"+id;$("#deleteModal").modal("hide");});$(".a_to_top").on("click",function(e){e.preventDefault();var id=$(this).data("id");$("#topModal #form_id").val(id);});$(".a_highlight").on("click",function(e){e.preventDefault();var id=$(this).data("id");$("#highlightModal #forms_id").val(id);});$(".a_to_premium").on("click",function(e){$(".loading").show();e.preventDefault();var id=$(this).data("id");var data={};data.adv={};data.adv[id]="on";data.packet=1;data.ajax=1;$.post("/myadvs",data,function(sdata){if(sdata){location.href=sdata;}else{$(".loading").hide();}});});$(".a_to_lite").on("click",function(e){$(".loading").show();e.preventDefault();var id=$(this).data("id");var data={};data.adv={};data.adv[id]="on";data.packet=2;data.ajax=1;$.post("/myadvs",data,function(sdata){if(sdata){location.href=sdata;}else{$(".loading").hide();}});});$(".a_company").on("click",function(e){e.preventDefault();var id=$(this).data("id");$("#companyModal #forms_id").val(id);});function update_all_advs(){$.ajax({type:"POST",url:"/update_all_advs",success:function(data){location.reload();}});}
function show_all_subs(){$(".categories .subs").css("height","inherit");$(".categories .all").hide();}