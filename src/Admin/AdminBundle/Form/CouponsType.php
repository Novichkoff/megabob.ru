<?phpnamespace Admin\AdminBundle\Form;use Symfony\Component\Form\AbstractType;use Symfony\Component\Form\FormBuilderInterface;use Symfony\Component\OptionsResolver\OptionsResolverInterface;use Symfony\Component\HttpFoundation\File\File;use Admin\AdminBundle\Model\RegionsQuery;use Admin\AdminBundle\Model\CouponsCategoriesQuery;class CouponsType extends AbstractType{    public function buildForm(FormBuilderInterface $builder, array $options)    {        $categories = CouponsCategoriesQuery::create()->findByDeleted(0);        $categories_array = array();        $categories_array[0] = 'Выберите категорию';        if ($categories) foreach ($categories as $category) {            $categories_array[$category->getId()]= ($category->getParentId()==0) ? $category->getName() : CouponsCategoriesQuery::create()->findOneById( $category->getParentId() )->getName().' -> '.$category->getName();        }        $builder            ->add('enabled', 'checkbox', array('label'  => 'Включено:', 'required' => FALSE))            ->add('cnt', 'text', array('label'  => 'Счетчик просмотров:', 'required' => FALSE, 'read_only' => TRUE))            ->add('date', 'datetime', array(                'widget'    => 'single_text',                'label'     => 'Дата создания:',                'required'  => FALSE,                'read_only' => TRUE))            ->add('use_before', 'datetime', array(                'widget'    => 'single_text',                'label'     => 'Дата окончания:',                'required'  => TRUE))            ->add('period', 'text', array('label'  => 'Срок действия (дней):', 'required' => TRUE))            ->add('name', 'text', array('label'  => 'Название купона:', 'required' => TRUE))            ->add('description', 'text', array('label'  => 'Краткое описание:', 'required' => FALSE))            ->add('full_description', 'genemu_tinymce', array(                'label'     => 'Полное описание:',                'required'  => false,                'configs'   => array(                    'language'                =>'ru',                    'height'                  => 400,                    'plugins'                 => array(                        "advlist autolink link image lists charmap print preview hr anchor pagebreak spellchecker",                        "searchreplace wordcount visualblocks visualchars code fullscreen insertdatetime media nonbreaking",                        "save table contextmenu directionality emoticons template paste textcolor"                    ),                    'theme_advanced_buttons1' => 'bold,italic,underline,undo,redo,link,unlink,forecolor,styleselect,removeformat,cleanup,code',                )            ))            ->add('category_id', 'choice', array(                'choices'   => $categories_array,                'label'  => 'Категория:',            ))            ->add('price', 'text', array('label'  => 'Стоимость купона:', 'required' => TRUE))            ->add('sale', 'text', array('label'  => 'Скидка (%):', 'required' => TRUE))            ->add('price_old', 'text', array('label'  => 'Стоимость без скидки:', 'required' => TRUE));        # Выбор Региона        $regions = RegionsQuery::create()            ->orderByName()            ->find();        $regions_array = array();        $regions_array[0]='Любой регион';        foreach ($regions as $region) {            $regions_array[$region->getId()] = $region->getName();        }        $builder            ->add('region_id', 'choice', array(                'choices'   => $regions_array,                'label'     => 'Регион:',                'required'  => FALSE            ));        $builder            ->add('phone', 'text', array('label'  => 'Телефон:', 'required' => FALSE))            ->add('address', 'text', array('label'  => 'Адрес:', 'required' => FALSE))            ->add('site', 'text', array('label'  => 'Сайт:', 'required' => FALSE))            ->add('time_work', 'text', array('label'  => 'Время работы:', 'required' => FALSE))            ->add('client_name', 'text', array('label'  => 'Клиент (имя):', 'required' => TRUE))            ->add('client_phone', 'text', array('label'  => 'Клиент (телефон):', 'required' => FALSE))            ->add('image', 'file', array('label'  => 'Изображение', 'required' => false, 'mapped' => false))            ->add('save', 'submit', array('label'  => 'Сохранить',))            ->getForm();    }    public function getName()    {        return 'Coupons';    }    public function setDefaultOptions(OptionsResolverInterface $resolver)    {        $resolver->setDefaults(array(            'data_class' => 'Admin\AdminBundle\Model\Coupons'        ));    }}